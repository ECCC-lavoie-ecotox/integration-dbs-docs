[
  {
    "objectID": "tbl_measurements.html",
    "href": "tbl_measurements.html",
    "title": "Description des contaminants",
    "section": "",
    "text": "Otenir une liste exhaustive des contaminants mesurés chez quatre espèces impliquées dans le PASL.\n\nRegrouper ces contaminants en famille\n\nDéterminer les tailles d’échantillons pour les combinaisons: Site, espèce, années, contaminant\n\nÉtablir le nombre de d’échantillons pour chaque combinaison\nÉtablir le nombre de données censurées pour chaque combinaison",
    "crumbs": [
      "Consolider les données",
      "Description des contaminants"
    ]
  },
  {
    "objectID": "tbl_measurements.html#objectifs",
    "href": "tbl_measurements.html#objectifs",
    "title": "Description des contaminants",
    "section": "",
    "text": "Otenir une liste exhaustive des contaminants mesurés chez quatre espèces impliquées dans le PASL.\n\nRegrouper ces contaminants en famille\n\nDéterminer les tailles d’échantillons pour les combinaisons: Site, espèce, années, contaminant\n\nÉtablir le nombre de d’échantillons pour chaque combinaison\nÉtablir le nombre de données censurées pour chaque combinaison",
    "crumbs": [
      "Consolider les données",
      "Description des contaminants"
    ]
  },
  {
    "objectID": "tbl_measurements.html#objectif-1.-otenir-une-liste-exhaustive-des-contaminants",
    "href": "tbl_measurements.html#objectif-1.-otenir-une-liste-exhaustive-des-contaminants",
    "title": "Description des contaminants",
    "section": "Objectif 1. Otenir une liste exhaustive des contaminants",
    "text": "Objectif 1. Otenir une liste exhaustive des contaminants\nOn cherche à obtenir une liste exhaustive des contaminants mesurés chez quatre espèces impliquées dans le PASL.\n\nIsolation des plages de données pour les contaminants\nRecencement des fichiers et des feuillets (1 feuillet = 1 famille) Pour chacun des fichiers et feuillets, j’identifie la plage de colonne dans laquelle se retrouve les valeurs des contaminants (voir la liste intitulée “sheets” pour chacun des fichiers).\n\ncontaminants_mapping &lt;- list(\n    herons = list(\n        path = \"Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees GBHE oeufs.xlsx\",\n        sheets = list(\n            PFC = c(\"PFBA\", \"PFDS\"),\n            OC = c(\"1.2.4.5-Tetrachlorobenzene\", \"TCPM\"),\n            PCB = c(\"PCB18/17\", \"Aroclor1260\"),\n            BFR = c(\"BDE-7\", \"anti-DP\"),\n            `non-ortho PCBs` = c(\"PCB-81\", \"PCB-169\"),\n            `PCDDs & PCDFs` = c(\"2378-TCDD\", \"OCDF\"),\n            Toxaphene = c(\"Total toxaphene\", \"B9-1025\"),\n            FAME = c(\"Caproic Acid\", \"Docosahexaenoic Acid (DHA)\"),\n            THg = c(\"THg-dw\", \"THg-ww\"),\n            SI = c(\"d13C\", \"d34S\")\n        )\n    ),\n    eiders = list(\n        path = \"Z:/01-Projets et suivis/PASL/EiderDuvet/Base de donnees COEI.xlsx\",\n        sheets = list(\n            PFC = c(\"PFBA\", \"PFDS\"),\n            OC = c(\"1,2,4,5-Tetrachlorobenzene\", \"Mirex\"),\n            PCB = c(\"PCB17/18\", \"PCB209\"),\n            BFR = c(\"b-TBECH/BDE15\", \"BB101\"),\n            THg = c(\"THg_dw\", \"THg_ww\")\n        )\n    ),\n    gulls = list(\n        path = \"Z:/01-Projets et suivis/PASL/GoelandArgenté/Base de donnees HERG.xlsx\",\n        sheets = list(\n            PFC = c(\"PFBA\", \"PFDS\"),\n            OC = c(\"1,2,4,5-Tetrachlorobenzene\", \"Mirex\"),\n            PCB = c(\"PCB17/18\", \"PCB209\"),\n            BFR = c(\"b-TBECH/BDE15\", \"BB101\"),\n            THg = c(\"THg\", \"THg\"),\n            SI = c(\"d13C\", \"d34S\")\n        )\n    ),\n    gannets = list(\n        path = \"Z:/01-Projets et suivis/PASL/FouBassan/Stats_NOGA_Temporal2022/Integration_ST LAWRENCE_Gannets Trends 1969-2019_OC-PCB-FR Metals D-F FAME CNS.xlsx\",\n        sheets = list(\n            OC = c(\"1245TCB\", \"Mirex\"),\n            PCB = c(\"PCB18/17\", \"Aroclor1260\"),\n            BFR = c(\"BDE-15_B-TBECH\", \"anti-DP\"),\n            `Non-ortho PCBs` = c(\"PCB 81\", \"PCB 169\"),\n            `PCDDs & PCDFs` = c(\"2378-TCDD\", \"OCDF\"),\n            Metal = c(\"THg\", \"Al\"),\n            FAME = c(\"caproic acid\", \"docosahexaenoic acid (DHA)\"),\n            SI = c(\"d15N\", \"CN\")\n        )\n    )\n)\n\n\n\nFusion des mesures de contaminants\nOn effectue une double map (comme une double loop). Cette opération va extraire les valeurs de contaminants en traversant les classeurs (1 par espèce), et les feuillets (1 par famille de contaminant).\n\ncontaminants &lt;- purrr::map(\n    # Loop over species dataset\n    contaminants_mapping, \\(f){\n        # Copy the excel file locally in the temp folder\n        tmp_file &lt;- tempfile()\n        file.copy(f$path, tmp_file, overwrite = TRUE)\n        # Loop over sheets\n        purrr::map2(f$sheets, names(f$sheets), \\(s, n){\n            readxl::read_excel(tmp_file, sheet = n) |&gt;\n                dplyr::select(\"Year\", \"Location\", \"SampleID\", \"Species\", s[1]:s[2]) |&gt;\n                dplyr::mutate(source = f$path, conpound_family = n) |&gt;\n                dplyr::mutate(across(everything(), as.character)) |&gt;\n                tidyr::pivot_longer(cols = s[1]:s[2], names_to = \"variable\") |&gt;\n                dplyr::filter(!is.na(value))\n        }) |&gt; dplyr::bind_rows()\n}) |&gt; dplyr::bind_rows()\n\ncontaminants |&gt; dplyr::group_by(Location) |&gt; dplyr::summarize(\n    nSpecies = dplyr::n_distinct(Species)) |&gt; dplyr::arrange(desc(nSpecies))\n\n# A tibble: 66 × 2\n   Location                                    nSpecies\n   &lt;chr&gt;                                          &lt;int&gt;\n 1 Ile Laval                                          3\n 2 Ile aux Oeufs                                      2\n 3 Kamouraska                                         2\n 4 Missipinuk (Grosse Romaine)                        2\n 5 Archipel de Mingan (approximative location)        1\n 6 Battures aux Loups Marins                          1\n 7 Beauharnois                                        1\n 8 Betchouanes                                        1\n 9 Bonaventure                                        1\n10 Bonaventure Island                                 1\n# ℹ 56 more rows\n\n\n\n\nQA sur les noms de contaminants\nCertains noms de composées divergent entre les différents classeurs de données (espèces)\n\ndups_contaminants &lt;- contaminants |&gt; \n    dplyr::group_by(conpound_family, variable) |&gt;\n    dplyr::arrange(desc(variable)) |&gt;\n    dplyr::count()\n\ndups_contaminants\n\n# A tibble: 398 × 3\n# Groups:   conpound_family, variable [398]\n   conpound_family variable             n\n   &lt;chr&gt;           &lt;chr&gt;            &lt;int&gt;\n 1 BFR             BB-101             133\n 2 BFR             BB101               40\n 3 BFR             BDE-100            140\n 4 BFR             BDE-116              3\n 5 BFR             BDE-119              7\n 6 BFR             BDE-126              3\n 7 BFR             BDE-138            140\n 8 BFR             BDE-140              7\n 9 BFR             BDE-15               4\n10 BFR             BDE-15 / β-TBECH    85\n# ℹ 388 more rows\n\n\nAtelier 1: Jouer a pareil, pas pareil, pour consolider la nomenclature des contaminants\n\n\nQA sur les noms des sites\n\ndups_sites &lt;- contaminants |&gt; \n    dplyr::group_by(Location) |&gt;\n    dplyr::count()\n\ndups_sites\n\n# A tibble: 66 × 2\n# Groups:   Location [66]\n   Location                                        n\n   &lt;chr&gt;                                       &lt;int&gt;\n 1 Archipel de Mingan (approximative location)   192\n 2 Battures aux Loups Marins                      51\n 3 Beauharnois                                   196\n 4 Betchouanes                                    85\n 5 Bonaventure                                    50\n 6 Bonaventure Island                           6097\n 7 Deslauriers                                    80\n 8 Escuminac                                      62\n 9 Grande Ile                                   3187\n10 Gros Pot                                       65\n# ℹ 56 more rows\n\n\nAtelier 2: Jouer a pareil, pas pareil, pour consolider la nomenclature des sites\n\n\nQA Data censurées\nOn applique la transformation avec la fonction toxbox::uncensored().\n\ncontaminants_uncensored &lt;- contaminants |&gt; \n    toxbox::uncensored(cols = \"value\", keep_cens = TRUE)\n\nWarning: There was 1 warning in `dplyr::mutate()`.\nℹ In argument: `dplyr::across(tidyselect::all_of(cols), remove_cens)`.\nCaused by warning:\n! NAs introduced by coercion\n\n\nIsolation des valeurs NA’s pour comprendre quelles sont les mesures qui ne peuvent pas être transformé en valeur numérique.\n\nQ1. Combien de données se retrouvent dans ce cas de figure?\n\ntable(is.na(contaminants_uncensored$value))\n\n\nFALSE  TRUE \n31592   780 \n\n\n\n\nQ2. Dans quelle classeur et quel onglet on retrouve ces valeurs?\n\ncontaminants_uncensored |&gt; \n    dplyr::filter(is.na(value)) |&gt;\n    dplyr::group_by(source, conpound_family) |&gt;\n    dplyr::count() |&gt;\n    dplyr::arrange(source)\n\n# A tibble: 7 × 3\n# Groups:   source, conpound_family [7]\n  source                                                   conpound_family     n\n  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;int&gt;\n1 Z:/01-Projets et suivis/PASL/FouBassan/Stats_NOGA_Tempo… FAME              597\n2 Z:/01-Projets et suivis/PASL/FouBassan/Stats_NOGA_Tempo… PCDDs & PCDFs       6\n3 Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees… OC                 21\n4 Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees… PCB                10\n5 Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees… PCDDs & PCDFs      96\n6 Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees… PFC                40\n7 Z:/01-Projets et suivis/PASL/GrandHeron/Base de donnees… non-ortho PCBs     10\n\n\n\n\nQ3. C’est quoi les valeurs qui ne peuvent pas être transférer en valeur numérique (après retrait du symbole &lt;)?\nTODO: A compléter ici, marche pas\n\ncontaminants |&gt; \n    dplyr::filter(stringr::str_detect(stringr::str_trim(value), \"[:alpha:]\")) |&gt;\n    as.data.frame()",
    "crumbs": [
      "Consolider les données",
      "Description des contaminants"
    ]
  },
  {
    "objectID": "tbl_measurements.html#objectif-2-déterminer-la-taille-déchantillons",
    "href": "tbl_measurements.html#objectif-2-déterminer-la-taille-déchantillons",
    "title": "Description des contaminants",
    "section": "Objectif 2: Déterminer la taille d’échantillons",
    "text": "Objectif 2: Déterminer la taille d’échantillons\nOn compte le nombre de mesures pour chaque combinaison.\ndata_count &lt;- contaminants |&gt; \n    dplyr::mutate(Year = as.integer(Year)) |&gt;\n    toxbox::uncensored(cols = \"value\", keep_cens = TRUE) |&gt;\n    dplyr::group_by(Location, Year, Species, conpound_family, variable) |&gt;\n    dplyr::summarise(n = dplyr::n(), n_censored = sum(value_censored))\nWarning: There was 1 warning in `dplyr::mutate()`.\nℹ In argument: `dplyr::across(tidyselect::all_of(cols), remove_cens)`.\nCaused by warning:\n! NAs introduced by coercion\n`summarise()` has grouped output by 'Location', 'Year', 'Species',\n'conpound_family'. You can override using the `.groups` argument.\n\ndata_count |&gt;\n    DT::datatable()\n\n\n\n\n\n\nCriteria 1. On retire les sites pour lesquelles, il y a une seule année de collecte (impossibilité de calibrer un modèle de tendance temporelle).\nVoici la liste des sites pour lesquelles, on a une seule année de mesure\ncrit1 &lt;- contaminants |&gt; \n    dplyr::select(Location, Year) |&gt;\n    dplyr::distinct() |&gt;\n    dplyr::group_by(Location) |&gt;\n    dplyr::count() |&gt;\n    dplyr::filter(n == 1) |&gt;\n    dplyr::pull(Location)\n\ncat(paste(\"*\", crit1), sep=\"\\n\")\n\nArchipel de Mingan (approximative location)\nBeauharnois\nBetchouanes\nBonaventure\nDeslauriers\nEscuminac\nGros Pot\nIle Beauséjour\nIle Bellechasse\nIle Bienville\nIle Blanche\nIle Dodens\nIle Dowker\nIle Nue\nIle Saint-Barnabé\nIle a Bouleau de Terre\nIle aux Pommes\nIle de la Madeleine\nIle de la Mine\nIle du Petit Caoui\nIle du Petit Caouis\nIle à Calculot des Betchouanes\nIles aux Loups Marins\nIles de la Madeleine\nIlets Boisés\nIlets De Quen\nKamouraska\nKukuministuk (Caye à Cochons)\nLac Bleu\nLac Evans\nLac Saint-Bernard\nLac St-Pierre\nLac à la Carpe\nLong Island\nMiller island\nMissipinuk (Grosse Romaine)\nPetit Lac Jacques Cartier\nPetite Ile Ste-Geneviève\nPointe Saint-Pancrace\nPrairie du Castor\nRiviere George\n\nOn retire ces sites pour l’étude de la taille de l’échantillon\n\ndata_count &lt;- data_count |&gt;\n    dplyr::filter(!(Location %in% crit1)) |&gt;\n    dplyr::ungroup()\n\n\n\nSite Battures aux Loups Marins\n\n\n\nSite Bonaventure Island\n\n\n\nSite Grande Ile\n\n\n\nSite Ile Carillon\n\n\n\nSite Ile Dickerson\n\n\n\nSite Ile Eaton\n\n\n\nSite Ile Laval\n\n\n\nSite Ile Manowin\n\n\n\nSite Ile Matane\n\n\n\nSite Ile Saint-Bernard\n\n\n\nSite Ile Steamboat\n\n\n\nSite Ile Villemomble\n\n\n\nSite Ile aux Basques\n\n\n\nSite Ile aux Herons\n\n\n\nSite Ile aux Hérons\n\n\n\nSite Ile aux Oeufs\n\n\n\nSite Ile de Carillon\n\n\n\nSite Ile de la Corneille\n\n\n\nSite Ile du Bic\n\n\n\nSite Ile du Corossol\n\n\n\nSite Iles Sainte-Marie\n\n\n\nSite Maria\n\n\n\nSite Petit lac Jacques-Cartier\n\n\n\nSite Refuge Watshishou\n\n\n\nSite Yamachiche",
    "crumbs": [
      "Consolider les données",
      "Description des contaminants"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "À quoi sert cette documentation?",
    "section": "",
    "text": "Le laboratoire de Raphael Lavoie effectue un travail d’intégration des données issues de mesure de contaminants sur des matrices biologiques pour une région d’étude couvrant l’Estuaire et le Golf du Saint-Laurent.\nCe travail d’intégration requière plusieurs étapes de validation et de consolidation des données. Ce document recense l’ensembles des étapes qui ont mener vers la construction de la base de données. Il rassemble également le code permettant de générer certaines figures exploratoires pour bien comprendre les données.",
    "crumbs": [
      "Introduction",
      "À quoi sert cette documentation?"
    ]
  },
  {
    "objectID": "deploy.html",
    "href": "deploy.html",
    "title": "Contribuer à cette documentation",
    "section": "",
    "text": "Pour construire cette documentation en locale, voici les étapes.",
    "crumbs": [
      "Introduction",
      "Contribuer à cette documentation"
    ]
  },
  {
    "objectID": "deploy.html#pré-requis",
    "href": "deploy.html#pré-requis",
    "title": "Contribuer à cette documentation",
    "section": "Pré-requis",
    "text": "Pré-requis\nInstaller les deux librairies R à l’aide des commandes suivantes:\n# install.packages(\"devtools\")\ndevtools::install_github(\"ECCC-lavoie-ecotox/toxbox\")\ninstall.packages(\"quarto\")",
    "crumbs": [
      "Introduction",
      "Contribuer à cette documentation"
    ]
  },
  {
    "objectID": "deploy.html#téleverser-le-code-source-sur-votre-poste-de-travail",
    "href": "deploy.html#téleverser-le-code-source-sur-votre-poste-de-travail",
    "title": "Contribuer à cette documentation",
    "section": "Téleverser le code source sur votre poste de travail",
    "text": "Téleverser le code source sur votre poste de travail\nTODO",
    "crumbs": [
      "Introduction",
      "Contribuer à cette documentation"
    ]
  },
  {
    "objectID": "deploy.html#construire-ce-site-internet",
    "href": "deploy.html#construire-ce-site-internet",
    "title": "Contribuer à cette documentation",
    "section": "Construire ce site internet",
    "text": "Construire ce site internet\n# Serve the website in your browser\nquarto::quarto_preview()\nCette approche permet de travailler en parallele sur les fichiers de documentation. À chaque fois qu’un fichier est modifié, le site internet est reconstruit pour inclure les dernières modifications.",
    "crumbs": [
      "Introduction",
      "Contribuer à cette documentation"
    ]
  },
  {
    "objectID": "tbl_analytes.html",
    "href": "tbl_analytes.html",
    "title": "Consolidation de la nomenclature des analytes",
    "section": "",
    "text": "Nous désirons consolider la nomenclature des analytes. On peut observer plusieurs divergences dans la facon de nommer les analytes, exemple PCB-17 ou PCB 17. Cette section documente la démarche pour tendre vers une réconciliation des termes utilisés.\nOn charge les données intégrées depuis le package toxbox. Les données ne sont pas entreposées dans le package, la function toxbox::dbs_integration() permet de lire les fichiers Excels entreposées sur le disque réseau Z: et les fusionne dans un seul data.frame. Il faut pour cela que le VPN soit ouvert, si vous n’êtes pas sur site.\n\ndevtools::install_github(\"ECCC-lavoie-ecotox/toxbox\")\n\nSkipping install of 'toxbox' from a github remote, the SHA1 (b95a07f6) has not changed since last install.\n  Use `force = TRUE` to force installation\n\n\n\nmeasurements &lt;- toxbox::dbs_integration()\nanalytes &lt;- readxl::read_excel(\"Z:/07-Données BD/TBL_analytes/analytes_consolidation_27032024.xlsx\")\n\n\nanalytes_cleaned &lt;- dplyr::select(analytes, Analyte, CASNumber) |&gt;\n    dplyr::mutate(\n        Analyte = janitor::make_clean_names(Analyte, allow_dupes = TRUE, case = \"none\") |&gt; tolower()\n    ) |&gt; dplyr::distinct()  \n\nmeasurements_cleaned &lt;- measurements |&gt; \n    dplyr::mutate(original_name = variable) |&gt;\n    dplyr::mutate(\n        variable = janitor::make_clean_names(variable, allow_dupes = TRUE, case = \"none\") |&gt; tolower()\n    ) \n\nmeasurements_with_cas &lt;-  analytes_cleaned |&gt;\n dplyr::right_join(\n    measurements_cleaned,\n    by = c(\"Analyte\" = \"variable\")\n)\n\ndplyr::filter(measurements_with_cas, is.na(CASNumber)) |&gt; \n    dplyr::distinct(Analyte, original_name) |&gt;\n    as.data.frame()\n\n                                       Analyte\n1                                b_tbech_bde15\n2                                 bde154_bb153\n3                                     pcb17_18\n4                                     pcb28_31\n5                                         d13c\n6                                         d15n\n7                                         d34s\n8                                       thg_dw\n9                                       thg_dw\n10                                         ala\n11                                         val\n12                                         ile\n13                                         asp\n14                                         pro\n15                                         glu\n16                                         phe\n17                                        tcpm\n18                           aroclor_1254_1260\n19                                 aroclor1260\n20                                   pcb_31_28\n21                                      pcb_52\n22                                      pcb_60\n23                                      pcb_64\n24                                      pcb_87\n25                                      pcb_95\n26                                      pcb_97\n27                                      pcb_99\n28                                     pcb_101\n29                                     pcb_105\n30                                     pcb_110\n31                                     pcb_118\n32                                     pcb_128\n33                                     pcb_129\n34                                     pcb_137\n35                                     pcb_138\n36                                     pcb_141\n37                                     pcb_146\n38                                     pcb_151\n39                                     pcb_153\n40                                     pcb_158\n41                                 pcb_170_190\n42                                     pcb_171\n43                                      pcb172\n44                                      pcb174\n45                                     pcb_187\n46                                     pcb_183\n47                                     pcb_185\n48                                     pcb_194\n49                                     pcb_195\n50                                     pcb_203\n51                                     pcb_200\n52                                     pcb_201\n53                                     pcb_206\n54                                      pcb_44\n55                                   pcb_47_48\n56                                      pcb_49\n57                                      pcb_70\n58                                      pcb_42\n59                                      pcb_74\n60                                     pcb_149\n61                                      pcb1_1\n62                                      pcb_66\n63                                    pcb18_17\n64                                   pcb_16_32\n65                                      pcb_33\n66                                      pcb_22\n67                                   pcb_56_60\n68                                      pcb_85\n69                                      pcb_92\n70                                     pcb_130\n71                                     pcb_156\n72                                     pcb_157\n73                                     pcb_176\n74                                     pcb_177\n75                                     pcb_178\n76                                     pcb_179\n77                                 pcb_196_203\n78                                     pcb_202\n79                                     pcb_207\n80                                     pcb_208\n81                                     pcb_114\n82                                     pcb_167\n83                                     pcb_189\n84                                     pcb_199\n85                                     pcb_205\n86                                     pcb_209\n87                              bde_15_b_tbech\n88                                      bde_17\n89                                      bde_28\n90                                      bde_47\n91                                      bde_49\n92                                      bde_66\n93                                      bde_85\n94                                      bde_99\n95                                     bde_100\n96                                     bde_138\n97                                     bde_153\n98                              bde_154_bb_153\n99                                     bde_183\n100                                    bde_190\n101                                    bde_209\n102                                     bb_101\n103                                      bde_7\n104                                      bde_8\n105                                     bde_15\n106                                     bde_te\n107                                    bde_te1\n108                                     bde_pe\n109                                    bde_119\n110                                    bde_pe1\n111                                    bde_155\n112                                    bde_140\n113                                    bde_hx1\n114                                    bde_hx2\n115                                     bde_hx\n116                                    bde_hp1\n117                                    bde_hp2\n118                                    bde_hp3\n119                                     bde_35\n120                                     bde_77\n121                                    bde_116\n122                                    bde_126\n123                                     pcb_81\n124                                     pcb_77\n125                                    pcb_126\n126                                    pcb_169\n127                                 x2378_tcdd\n128                               x12378_pecdd\n129                              x123678_hxcdd\n130                             x1234678_hpcdd\n131                                       ocdd\n132                                 x2378_tcdf\n133                               x23478_pecdf\n134                              x123478_hxcdd\n135                              x123789_hxcdd\n136                             x12346789_ocdd\n137                               x12478_pecdf\n138                               x12378_pecdf\n139                              x123478_hxcdf\n140                              x123678_hxcdf\n141                              x234678_hxcdf\n142                              x123789_hxcdf\n143                             x1234678_hpcdf\n144                             x1234789_hpcdf\n145                             x12346789_ocdf\n146                                       ocdf\n147                            total_toxaphene\n148                                       hexa\n149                                      hepta\n150                                       octa\n151                                       nona\n152                                       deca\n153                                    b6_923a\n154                                    b7_1001\n155                                    b8_1413\n156                                    b8_1412\n157                                    b7_1450\n158                                     toxa31\n159                                     b7_515\n160                                     b8_789\n161                                   b7_1059a\n162                                     b8_531\n163                                b81414_1945\n164                                     b8_806\n165                                    b8_2229\n166                                     b8_810\n167                                    b9_1679\n168                                     b9_718\n169                                    b8_1471\n170                                b9_743_2006\n171                                    b9_1046\n172                                     b9_715\n173                                    b9_1025\n174                               caproic_acid\n175                              caprylic_acid\n176                                capric_acid\n177                            undecanoic_acid\n178                                lauric_acid\n179                           tridecanoic_acid\n180                              myristic_acid\n181                           myristoleic_acid\n182                         pentadecanoic_acid\n183                  cis_10_pentadecanoic_acid\n184                              palmitic_acid\n185                           palmitoleic_acid\n186                         heptadecanoic_acid\n187                  cis_10_heptadecanoic_acid\n188                               stearic_acid\n189                               elaidic_acid\n190                                 oleic_acid\n191                          linolelaidic_acid\n192                              linoleic_acid\n193                             arachidic_acid\n194                       g_linolenic_acid_gla\n195                     cis_11_eicosenoic_acid\n196                       a_linolenic_acid_ala\n197                         heneicosanoic_acid\n198  cis_11_14_eicosadienoic_acid_methyl_ester\n199                               behenic_acid\n200       cis_8_11_14_eicosatrienoic_acid_dgla\n201                                erucic_acid\n202       cis_11_14_17_eicosatrienoic_acid_ete\n203                       arachidonic_acid_ara\n204                           tricosanoic_acid\n205               cis_13_16_docosadienoic_acid\n206                            lignoceric_acid\n207 cis_5_8_11_14_17_eicosapentaenoic_acid_epa\n208                              nervonic_acid\n209                  docosapentaenoic_acid_dpa\n210                   docosahexaenoic_acid_dha\n211                                     thg_ww\n212                                     thg_ww\n213                                        thg\n214                                        hcb\n215                                       ahch\n216                                       bhch\n217                                       ghch\n218                                         he\n219                                 tchlordane\n220                                 cchlordane\n221                                 cnonachlor\n222                                      ppdde\n223                                      ppddd\n224                                      ppddt\n225                                   x1245tcb\n226                                   x1234tcb\n227                                       pncb\n228                                        ocs\n229                                 tnonachlor\n230                                  sumlabpcb\n231                                   sum35pcb\n232                                   sum25pcb\n233                             bde_15_b_tbech\n234                             bde_154_bb_153\n235                                     pcb_81\n236                                     pcb_77\n237                                    pcb_126\n238                                    pcb_169\n239                                         se\n240                                      se_ww\n241                                         as\n242                                         mn\n243                                         cu\n244                                         zn\n245                                         rb\n246                                         cd\n247                                         pb\n248                                         li\n249                                         be\n250                                          v\n251                                         fe\n252                                         co\n253                                         ni\n254                                         ga\n255                                         sr\n256                                         mo\n257                                         ag\n258                                         sn\n259                                         sb\n260                                         ba\n261                                         tl\n262                                         bi\n263                                          u\n264                                         al\n265                               caproic_acid\n266                              caprylic_acid\n267                                capric_acid\n268                            undecanoic_acid\n269                                lauric_acid\n270                           tridecanoic_acid\n271                              myristic_acid\n272                           myristoleic_acid\n273                         pentadecanoic_acid\n274                  cis_10_pentadecanoic_acid\n275                              palmitic_acid\n276                           palmitoleic_acid\n277                         heptadecanoic_acid\n278                  cis_10_heptadecanoic_acid\n279                               stearic_acid\n280                               elaidic_acid\n281                                 oleic_acid\n282                          linolelaidic_acid\n283                              linoleic_acid\n284                             arachidic_acid\n285                           g_linolenic_acid\n286                            eicosenoic_acid\n287                       a_linolenic_acid_ala\n288                         heneicosanoic_acid\n289               cis_11_14_eicosadienoic_acid\n290                               behenic_acid\n291                      homo_g_linolenic_acid\n292                                erucic_acid\n293                    eicosatrienoic_acid_eta\n294                       arachidonic_acid_ara\n295                           tricosanoic_acid\n296               cis_13_16_docosadienoic_acid\n297                            lignoceric_acid\n298                  eicosapentaenoic_acid_epa\n299                              nervonic_acid\n300                  docosapentaenoic_acid_dpa\n301                   docosahexaenoic_acid_dha\n302                                         pn\n303                                         pc\n304                                         cn\n305                                         ps\n                                   original_name\n1                                  b-TBECH/BDE15\n2                                   BDE154/BB153\n3                                       PCB17/18\n4                                       PCB28/31\n5                                           d13C\n6                                           d15N\n7                                           d34S\n8                                         THg-dw\n9                                         THg_dw\n10                                           Ala\n11                                           Val\n12                                           Ile\n13                                           Asp\n14                                           Pro\n15                                           Glu\n16                                           Phe\n17                                          TCPM\n18                             Aroclor 1254/1260\n19                                   Aroclor1260\n20                                     PCB 31/28\n21                                        PCB 52\n22                                        PCB 60\n23                                        PCB 64\n24                                        PCB 87\n25                                        PCB 95\n26                                        PCB 97\n27                                        PCB 99\n28                                       PCB 101\n29                                       PCB 105\n30                                       PCB 110\n31                                       PCB 118\n32                                       PCB 128\n33                                       PCB 129\n34                                       PCB 137\n35                                       PCB 138\n36                                       PCB 141\n37                                       PCB 146\n38                                       PCB 151\n39                                       PCB 153\n40                                       PCB 158\n41                                   PCB 170/190\n42                                       PCB 171\n43                                        PCB172\n44                                        PCB174\n45                                       PCB 187\n46                                       PCB 183\n47                                       PCB 185\n48                                       PCB 194\n49                                       PCB 195\n50                                       PCB 203\n51                                       PCB 200\n52                                       PCB 201\n53                                       PCB 206\n54                                        PCB 44\n55                                     PCB 47/48\n56                                        PCB 49\n57                                        PCB 70\n58                                        PCB 42\n59                                        PCB 74\n60                                       PCB 149\n61                                        PCB1:1\n62                                        PCB 66\n63                                      PCB18/17\n64                                     PCB 16/32\n65                                        PCB 33\n66                                        PCB 22\n67                                     PCB 56/60\n68                                        PCB 85\n69                                        PCB 92\n70                                       PCB 130\n71                                       PCB 156\n72                                       PCB 157\n73                                       PCB 176\n74                                       PCB 177\n75                                       PCB 178\n76                                       PCB 179\n77                                   PCB 196/203\n78                                       PCB 202\n79                                       PCB 207\n80                                       PCB 208\n81                                       PCB 114\n82                                       PCB 167\n83                                       PCB 189\n84                                       PCB 199\n85                                       PCB 205\n86                                       PCB 209\n87                              BDE-15 / β-TBECH\n88                                        BDE-17\n89                                        BDE-28\n90                                        BDE-47\n91                                        BDE-49\n92                                        BDE-66\n93                                        BDE-85\n94                                        BDE-99\n95                                       BDE-100\n96                                       BDE-138\n97                                       BDE-153\n98                              BDE-154 / BB-153\n99                                       BDE-183\n100                                      BDE-190\n101                                      BDE-209\n102                                       BB-101\n103                                        BDE-7\n104                                        BDE-8\n105                                       BDE-15\n106                                       BDE-Te\n107                                      BDE-Te1\n108                                       BDE-Pe\n109                                      BDE-119\n110                                      BDE-Pe1\n111                                      BDE-155\n112                                      BDE-140\n113                                      BDE-Hx1\n114                                      BDE-Hx2\n115                                       BDE-Hx\n116                                      BDE-Hp1\n117                                      BDE-Hp2\n118                                      BDE-Hp3\n119                                       BDE-35\n120                                       BDE-77\n121                                      BDE-116\n122                                      BDE-126\n123                                       PCB-81\n124                                       PCB-77\n125                                      PCB-126\n126                                      PCB-169\n127                                    2378-TCDD\n128                                  12378-PeCDD\n129                                 123678-HxCDD\n130                                1234678-HpCDD\n131                                         OCDD\n132                                    2378-TCDF\n133                                  23478-PeCDF\n134                                 123478-HxCDD\n135                                 123789-HxCDD\n136                                12346789-OCDD\n137                                  12478-PeCDF\n138                                  12378-PeCDF\n139                                 123478-HxCDF\n140                                 123678-HxCDF\n141                                 234678-HxCDF\n142                                 123789-HxCDF\n143                                1234678-HpCDF\n144                                1234789-HpCDF\n145                                12346789-OCDF\n146                                         OCDF\n147                              Total toxaphene\n148                                         Hexa\n149                                        Hepta\n150                                         Octa\n151                                         Nona\n152                                         Deca\n153                                      B6-923a\n154                                      B7-1001\n155                                      B8-1413\n156                                      b8-1412\n157                                      B7-1450\n158                                       toxa31\n159                                       B7-515\n160                                       B8-789\n161                                     B7-1059a\n162                                       B8-531\n163                                  B81414/1945\n164                                       B8-806\n165                                      B8-2229\n166                                       B8-810\n167                                      B9-1679\n168                                       B9-718\n169                                      B8-1471\n170                                  B9-743/2006\n171                                      B9-1046\n172                                       B9-715\n173                                      B9-1025\n174                                 Caproic Acid\n175                                Caprylic Acid\n176                                  Capric Acid\n177                              Undecanoic Acid\n178                                  Lauric Acid\n179                             Tridecanoic Acid\n180                                Myristic Acid\n181                             Myristoleic Acid\n182                           Pentadecanoic Acid\n183                    cis-10-Pentadecanoic Acid\n184                                Palmitic Acid\n185                             Palmitoleic Acid\n186                           Heptadecanoic Acid\n187                    cis-10-Heptadecanoic Acid\n188                                 Stearic Acid\n189                                 Elaidic Acid\n190                                   Oleic Acid\n191                            Linolelaidic Acid\n192                                Linoleic Acid\n193                               Arachidic Acid\n194                       g-Linolenic Acid (GLA)\n195                       cis-11-Eicosenoic acid\n196                      a-Linolenic Acid  (ALA)\n197                           Heneicosanoic Acid\n198    cis-11,14-Eicosadienoic Acid Methyl Ester\n199                                 Behenic Acid\n200       cis-8,11,14-Eicosatrienoic Acid (DGLA)\n201                                  Erucic Acid\n202       cis-11,14,17-Eicosatrienoic Acid (ETE)\n203                       Arachidonic Acid (ARA)\n204                             Tricosanoic Acid\n205                 cis-13,16-Docosadienoic Acid\n206                              Lignoceric Acid\n207 cis-5,8,11,14,17-Eicosapentaenoic Acid (EPA)\n208                                Nervonic Acid\n209                  Docosapentaenoic Acid (DPA)\n210                   Docosahexaenoic Acid (DHA)\n211                                       THg-ww\n212                                       THg_ww\n213                                          THg\n214                                          HCB\n215                                         aHCH\n216                                         bHCH\n217                                         gHCH\n218                                           HE\n219                                   tChlordane\n220                                   cChlordane\n221                                   cNonachlor\n222                                        ppDDE\n223                                        ppDDD\n224                                        ppDDT\n225                                      1245TCB\n226                                      1234TCB\n227                                         PnCB\n228                                          OCS\n229                                   tNonachlor\n230                                    SumLabPCB\n231                                     Sum35PCB\n232                                     Sum25PCB\n233                               BDE-15_B-TBECH\n234                               BDE-154_BB-153\n235                                       PCB 81\n236                                       PCB 77\n237                                      PCB 126\n238                                      PCB 169\n239                                           Se\n240                                        Se-ww\n241                                           As\n242                                           Mn\n243                                           Cu\n244                                           Zn\n245                                           Rb\n246                                           Cd\n247                                           Pb\n248                                           Li\n249                                           Be\n250                                            V\n251                                           Fe\n252                                           Co\n253                                           Ni\n254                                           Ga\n255                                           Sr\n256                                           Mo\n257                                           Ag\n258                                           Sn\n259                                           Sb\n260                                           Ba\n261                                           Tl\n262                                           Bi\n263                                            U\n264                                           Al\n265                                 caproic acid\n266                                caprylic acid\n267                                  capric acid\n268                              undecanoic acid\n269                                  lauric acid\n270                             tridecanoic acid\n271                                myristic acid\n272                             myristoleic acid\n273                           pentadecanoic acid\n274                    cis-10-pentadecanoic acid\n275                                palmitic acid\n276                             palmitoleic acid\n277                           heptadecanoic acid\n278                    cis-10-heptadecanoic acid\n279                                 stearic acid\n280                                 elaidic acid\n281                                   oleic acid\n282                            linolelaidic acid\n283                                linoleic acid\n284                               arachidic acid\n285                             γ-linolenic acid\n286                              eicosenoic acid\n287                       α-linolenic acid (ALA)\n288                           heneicosanoic acid\n289                 cis-11,14-eicosadienoic acid\n290                                 behenic acid\n291                        homo-γ-linolenic acid\n292                                  erucic acid\n293                    eicosatrienoic acid (ETA)\n294                       arachidonic acid (ARA)\n295                             tricosanoic acid\n296                 cis-13,16-docosadienoic acid\n297                              lignoceric acid\n298                  eicosapentaenoic acid (EPA)\n299                                nervonic acid\n300                  docosapentaenoic acid (DPA)\n301                   docosahexaenoic acid (DHA)\n302                                           pN\n303                                           pC\n304                                           CN\n305                                           pS",
    "crumbs": [
      "Consolider les données",
      "Consolidation de la nomenclature des analytes"
    ]
  },
  {
    "objectID": "tbl_projects.html",
    "href": "tbl_projects.html",
    "title": "Recensement des projets",
    "section": "",
    "text": "Chaque rapport de laboratoire contient sur sa page de garde l’ensemble des métadonnées en lien avec le projet de recherche pour lequel cette analyse a été demandé. On désire donc extraire la page de garde de chacun des rapports de laboratoires afin d’obtenir la liste des projets.\nUn rapport de laboratoire peut être detectable dans une liste de fichier par la structure de son identifiant unique. Voici un exemple d’identifiant unique: CHEM-PCDD-00-07 ou encore MB-05-10. Ces identifiants ont une structure unique que l’on peut detecter grace à l’expression régulière suivante:\n\nregex_report_id &lt;- \"([A-Za-z]{2,5}-)?[A-Za-z]{2,5}-\\\\d{2}-\\\\d{2}\"\n\nLa variable regex_report_id sera utilisée plusieurs fois dans ce document.\nOn liste les rapports de laboratoire présents dans le dossier 03-Labo/Results Reports.\n\nreports_path &lt;- list.files(\n    \"C:/Users/VissaultS/Documents/03-Labo/Results Reports\", \n    pattern = \"*.pdf|*.docx|*.doc\", recursive = TRUE, full.names = TRUE\n)\n\n# On extrait les identifiants des rapports du nom du fichier\nreport_id &lt;- stringr::str_extract(reports_path, regex_report_id)\n\n# On obtient la signature du fichier, ca va être pratique pour detecter les fichiers dupliqués même si le nom du fichier est différent.\nfile_hash &lt;- tools::md5sum(reports_path)\n\n# On extrait l'extension du fichier\nfile_ext &lt;- reports_path |&gt; \n    strsplit(\"[.]\") |&gt; \n    purrr::map_chr(\\(e) return(e[2]))\n\n# On compose un tableau avec l'ensemble de ces informations\nreports &lt;- data.frame(\n        path = reports_path, \n        id = report_id, \n        hash = file_hash, \n        ext = file_ext\n    ) |&gt; tibble::as_tibble()\n\nNote: tools::md5sum permet de générer une signature unique propre au fichier. Ainsi deux fichiers identiques dans le contenu mais avec des noms différents pourront être identifié comme des duplicats.\nVoici la liste des fichiers identiques dans le dossier 03-Labo/Results Reports.\nreports_dup &lt;- reports |&gt; \n    tibble::as_tibble() |&gt;\n    janitor::get_dupes(-c(path)) |&gt;\n    dplyr::select(-hash)\n\nreports_dup |&gt; knitr::kable()\n\n\n\n\n\n\n\n\n\nid\next\ndupe_count\npath\n\n\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/MET-THg-23-13 - RALA01-2023.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/MET-THg-23-13 - RALA01-2023.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-23-13 - RALA01-2023_OeufsCOEI-HERG2023.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nCHEM-OC-21-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-21-08R.pdf\n\n\nCHEM-OC-21-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/CHEM-OC-21-08R.pdf\n\n\nCHEM-OC-22-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-22-05_HERGDeslauriers.pdf\n\n\nCHEM-OC-22-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/CHEM-OC-22-05_HERGDeslauriers.pdf\n\n\nCHEM-OC-23-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-23-08_EggHERG_COEI_2023.pdf\n\n\nCHEM-OC-23-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/CHEM-OC-23-08_EggHERG_COEI_2023.pdf\n\n\nMET-THg-21-03\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/MET-THg-21-03.pdf\n\n\nMET-THg-21-03\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-21-03 - RALA01-2021_eggs.pdf\n\n\nTP-SI-21-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/TP-SI-21-05C.pdf\n\n\nTP-SI-21-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/TP-SI-21-05C_RALA01-2021.pdf\n\n\n\nOn selectionne le premier rapport en se basant sur le id (ex. BMK-PFC-23-01) pour éliminer les rapports dupliqués pour la suite de l’analyse. On s’assure de selectionner préférablement les pdfs si on dispose d’un docx et d’un document pdf pour le même identifiant de rapport de laboratoire.\n\nreports &lt;- reports |&gt; \n    # On retire les rapports qui sont dupliqués\n    dplyr::group_by(hash) |&gt;\n    dplyr::slice(1) |&gt;\n    dplyr::ungroup() |&gt;\n    # Si plusieurs extension de fichiers, on selectionne ceux en PDF préférablement, sinon .docx, sinon .doc en dernier recours.\n    dplyr::group_split(id) |&gt;\n    purrr::map(\\(g){\n        g |&gt; dplyr::arrange(factor(ext, levels = c('pdf', 'docx', 'doc'))) |&gt;\n        dplyr::slice(1)\n    }) |&gt;\n    dplyr::bind_rows()\n\nQuelques rapports de laboratoire demeurent au format doc et docx.\ndocs &lt;- reports |&gt; dplyr::filter(ext %in% c('doc', 'docx')) \ndocs |&gt; knitr::kable()\n\n\n\npath\nid\nhash\next\n\n\n\n\n\nAfin de faciliter l’extraction des métadonnées par programmation, on convertit les fichiers .doc et .docx en pdf.",
    "crumbs": [
      "Consolider les données",
      "Recensement des projets"
    ]
  },
  {
    "objectID": "tbl_projects.html#établir-une-liste-des-projets",
    "href": "tbl_projects.html#établir-une-liste-des-projets",
    "title": "Recensement des projets",
    "section": "",
    "text": "Chaque rapport de laboratoire contient sur sa page de garde l’ensemble des métadonnées en lien avec le projet de recherche pour lequel cette analyse a été demandé. On désire donc extraire la page de garde de chacun des rapports de laboratoires afin d’obtenir la liste des projets.\nUn rapport de laboratoire peut être detectable dans une liste de fichier par la structure de son identifiant unique. Voici un exemple d’identifiant unique: CHEM-PCDD-00-07 ou encore MB-05-10. Ces identifiants ont une structure unique que l’on peut detecter grace à l’expression régulière suivante:\n\nregex_report_id &lt;- \"([A-Za-z]{2,5}-)?[A-Za-z]{2,5}-\\\\d{2}-\\\\d{2}\"\n\nLa variable regex_report_id sera utilisée plusieurs fois dans ce document.\nOn liste les rapports de laboratoire présents dans le dossier 03-Labo/Results Reports.\n\nreports_path &lt;- list.files(\n    \"C:/Users/VissaultS/Documents/03-Labo/Results Reports\", \n    pattern = \"*.pdf|*.docx|*.doc\", recursive = TRUE, full.names = TRUE\n)\n\n# On extrait les identifiants des rapports du nom du fichier\nreport_id &lt;- stringr::str_extract(reports_path, regex_report_id)\n\n# On obtient la signature du fichier, ca va être pratique pour detecter les fichiers dupliqués même si le nom du fichier est différent.\nfile_hash &lt;- tools::md5sum(reports_path)\n\n# On extrait l'extension du fichier\nfile_ext &lt;- reports_path |&gt; \n    strsplit(\"[.]\") |&gt; \n    purrr::map_chr(\\(e) return(e[2]))\n\n# On compose un tableau avec l'ensemble de ces informations\nreports &lt;- data.frame(\n        path = reports_path, \n        id = report_id, \n        hash = file_hash, \n        ext = file_ext\n    ) |&gt; tibble::as_tibble()\n\nNote: tools::md5sum permet de générer une signature unique propre au fichier. Ainsi deux fichiers identiques dans le contenu mais avec des noms différents pourront être identifié comme des duplicats.\nVoici la liste des fichiers identiques dans le dossier 03-Labo/Results Reports.\nreports_dup &lt;- reports |&gt; \n    tibble::as_tibble() |&gt;\n    janitor::get_dupes(-c(path)) |&gt;\n    dplyr::select(-hash)\n\nreports_dup |&gt; knitr::kable()\n\n\n\n\n\n\n\n\n\nid\next\ndupe_count\npath\n\n\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nBMK-PFC-23-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/BMK-PFC-23-10_HERG-COEI_eggs2023.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nCHEM-OC-22-10\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/CHEM-OC-22-10_GBHE-HERG2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-22-05\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-22-05 - RALA01-2022_HERG-GBHEegg2022.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/MET-THg-23-13 - RALA01-2023.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/MET-THg-23-13 - RALA01-2023.pdf\n\n\nMET-THg-23-13\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-23-13 - RALA01-2023_OeufsCOEI-HERG2023.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GrandHeron Rapports xxxx-2022/Rapports/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nTP-SI-22-09\npdf\n3\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/TP-SI-22-09C_RALA01-2022_HERG-GBHEeggs2022.pdf\n\n\nCHEM-OC-21-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-21-08R.pdf\n\n\nCHEM-OC-21-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/CHEM-OC-21-08R.pdf\n\n\nCHEM-OC-22-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-22-05_HERGDeslauriers.pdf\n\n\nCHEM-OC-22-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/GoelandArgente 2017, 2022-23/CHEM-OC-22-05_HERGDeslauriers.pdf\n\n\nCHEM-OC-23-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/CHEM-OC-23-08_EggHERG_COEI_2023.pdf\n\n\nCHEM-OC-23-08\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/EideràDuvet Rapports 1972-2023/CHEM-OC-23-08_EggHERG_COEI_2023.pdf\n\n\nMET-THg-21-03\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/MET-THg-21-03.pdf\n\n\nMET-THg-21-03\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/MET-THg-21-03 - RALA01-2021_eggs.pdf\n\n\nTP-SI-21-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/FouBassan Rapports 1984-2019/TP-SI-21-05C.pdf\n\n\nTP-SI-21-05\npdf\n2\nC:/Users/VissaultS/Documents/03-Labo/Results Reports/TP-SI-21-05C_RALA01-2021.pdf\n\n\n\nOn selectionne le premier rapport en se basant sur le id (ex. BMK-PFC-23-01) pour éliminer les rapports dupliqués pour la suite de l’analyse. On s’assure de selectionner préférablement les pdfs si on dispose d’un docx et d’un document pdf pour le même identifiant de rapport de laboratoire.\n\nreports &lt;- reports |&gt; \n    # On retire les rapports qui sont dupliqués\n    dplyr::group_by(hash) |&gt;\n    dplyr::slice(1) |&gt;\n    dplyr::ungroup() |&gt;\n    # Si plusieurs extension de fichiers, on selectionne ceux en PDF préférablement, sinon .docx, sinon .doc en dernier recours.\n    dplyr::group_split(id) |&gt;\n    purrr::map(\\(g){\n        g |&gt; dplyr::arrange(factor(ext, levels = c('pdf', 'docx', 'doc'))) |&gt;\n        dplyr::slice(1)\n    }) |&gt;\n    dplyr::bind_rows()\n\nQuelques rapports de laboratoire demeurent au format doc et docx.\ndocs &lt;- reports |&gt; dplyr::filter(ext %in% c('doc', 'docx')) \ndocs |&gt; knitr::kable()\n\n\n\npath\nid\nhash\next\n\n\n\n\n\nAfin de faciliter l’extraction des métadonnées par programmation, on convertit les fichiers .doc et .docx en pdf.",
    "crumbs": [
      "Consolider les données",
      "Recensement des projets"
    ]
  },
  {
    "objectID": "tbl_projects.html#convertion-des-documents-word-en-pdf",
    "href": "tbl_projects.html#convertion-des-documents-word-en-pdf",
    "title": "Recensement des projets",
    "section": "Convertion des documents Word en pdf",
    "text": "Convertion des documents Word en pdf\nCette étape a été complété manuellement.",
    "crumbs": [
      "Consolider les données",
      "Recensement des projets"
    ]
  },
  {
    "objectID": "tbl_projects.html#extraire-les-métadonnées-du-rapport",
    "href": "tbl_projects.html#extraire-les-métadonnées-du-rapport",
    "title": "Recensement des projets",
    "section": "Extraire les métadonnées du rapport",
    "text": "Extraire les métadonnées du rapport\nNous souhaitons générer une liste de tous les projets basée sur les 71 rapports de laboratoire stockés dans le dossier 03-Labo/Comptes rendus de résultats. La première page de chaque rapport de laboratoire contient toutes les informations pertinentes pour produire cette liste.\nPour chaque rapport, nous vérifions s’il s’agit d’une image ou non. Si le rapport est une image, nous devons utiliser une reconnaissance optique de caractères (OCR) afin d’extraire le texte de la première page et d’obtenir toutes les métadonnées pertinentes. Si c’est un pdf ou un fichier word, nous importons la première page du document.\n\n# On détect si le document est une image\nreports &lt;- reports |&gt; dplyr::mutate(\n    filename = basename(path),\n    is_image = purrr::map2_lgl(path, ext, \\(p, e) {\n        if(e == \"pdf\"){\n            out &lt;- pdftools::pdf_text(p)\n            !all(nchar(out) &gt; 15)\n        } else {\n            FALSE\n        }\n    })\n)\n\n# On extrait le texte par OCR si c'est une image\nfrontpages &lt;- purrr::map2_vec(reports$path, reports$is_image, \\(p, i) {\n        ifelse(isTRUE(i), \n            pdftools::pdf_ocr_text(pdf = p, pages = 1),\n            pdftools::pdf_text(pdf = p)[[1]]\n        )\n    }) |&gt; tolower()\n\nUne fois le texte de la première page isolé, on applique une série d’opération d’extractions de texte à partir de la position de mots clés. On isole ainsi le titre du projet, l’ID du projet, la date etc.\n\nproject_id &lt;- purrr::map_vec(frontpages, \\(f){\n    stringr::str_extract(f, \"(?&lt;=(project: |project |projects|projet :)).*(?=\\n)\")\n}) |&gt; \n    toupper() |&gt; \n    stringr::word(1) |&gt; \n    stringr::str_replace_all(\"[.,]\", \"\") |&gt;\n    stringr::str_trim() |&gt;\n    dplyr::na_if(\"\")\n\nproject_leader &lt;- purrr::map_vec(frontpages, \\(f){\n        stringr::str_extract(f, \"(?&lt;=(project leader: |project leader |project manager: |manager: |study leader: |nom du requérant :)).*(?=\\n)\")\n    }) |&gt; \n    stringr::str_replace_all(c(\"[_|:]\" = \"\", \"[:digit:]\" = \"\", \"[.]$\" = \"\")) |&gt; \n    stringr::str_to_title() |&gt;\n    stringr::str_trim()\n\nproject_dates &lt;- frontpages |&gt;\n    purrr::map_vec(\\(f){\n        dates &lt;- stringr::str_extract(f, \"\\\\d{4}-\\\\d{2}-\\\\d{2}\")\n        if(is.na(dates)) {\n            dates &lt;- stringr::str_extract(f, \"(?&lt;=(date: )).*(?=\\n)\")\n        }\n        return(dates)\n    }) \n        \nreportsProject &lt;- data.frame(\n    report_id = reports$id, \n    report_access_path = stringr::str_replace_all(reports$path, \"C:/Users/VissaultS/Documents\", \"Z:\"), \n    project_id, project_leader, project_dates, project_title = NA\n)\n\nLe data.frame reportsProject est à la base du fichier “Z:\\07-Données BD_projects_list_extract_25032024.xlsx”.",
    "crumbs": [
      "Consolider les données",
      "Recensement des projets"
    ]
  },
  {
    "objectID": "tbl_projects.html#valider-lexistence-de-rapports-de-laboratoire-dans-le-dossier-01-projet-et-suivis",
    "href": "tbl_projects.html#valider-lexistence-de-rapports-de-laboratoire-dans-le-dossier-01-projet-et-suivis",
    "title": "Recensement des projets",
    "section": "Valider l’existence de rapports de laboratoire dans le dossier 01-Projet et suivis",
    "text": "Valider l’existence de rapports de laboratoire dans le dossier 01-Projet et suivis\nOn valide si certains de ces rapports ne se retrouvent pas dans le dossier 03-Labo/Comptes rendus. Ces rapports pourraient potentiellement nous interressés.\n\nfiles &lt;- list.files(\n    \"C:/Users/VissaultS/Documents/01-Projets et suivis\", \n    pattern = \"*.pdf|*.docx|*.doc\", recursive = TRUE, full.names = TRUE\n)\n\npotential_reports &lt;- data.frame(file = files[which(stringr::str_detect(files, regex_report_id))])\n\npotential_reports &lt;- potential_reports |&gt; dplyr::mutate(\n    id = stringr::str_extract(file, regex_report_id) |&gt; toupper(),\n    in_lab_report_folder = !(id %in% reports$id)\n) |&gt; dplyr::arrange(in_lab_report_folder) |&gt;\n    dplyr::mutate(file = stringr::str_replace(file, \"C:/Users/VissaultS/Documents/\", \"Z:\"))",
    "crumbs": [
      "Consolider les données",
      "Recensement des projets"
    ]
  }
]